!function($){Util.Dialog=function(o){defaults=$.extend({type:"dialog",theme:"defaults",title:"标题",className:"",boxID:Util.random(10),referID:"",content:"text:内容",width:"",height:"",minHeight:"",time:"",drag:!0,lock:!0,fixed:!1,showbg:!1,showborder:!1,showtitle:!0,position:"",arrow:"left",tips:"",yesBtn:null,noBtn:null,minBtn:!1,maxBtn:!1,cfns:"",ofns:"",customBtn:null,beforeClose:"",hidden:!1},o),Util.Dialog.init(defaults)},$.extend(Util.Dialog,{data:{box:null,winarr:[],contentType:"",zindex:870618},init:function(o){if(Util.getID(o.boxID))return void $("#"+o.boxID).parent(".ui_dialog_wrap").show();Util.Dialog.create(o),Util.Dialog.loadContent(o),Util.Dialog.min(o),Util.Dialog.max(o),Util.Dialog.restore(o),o.customBtn&&Util.Dialog.customBtn(o),o.yesBtn&&Util.Dialog.yesBtn(o),o.noBtn&&Util.Dialog.noBtn(o),o.fixed&&(Util.fixed(o.boxID),Util.fixed(o.boxID+"_move_temp")),"number"==typeof o.time&&setTimeout(function(){Util.Dialog.close(o.boxID,o.cfns,o)},o.time),Util.Browser.isIE||$(window).resize(function(){Util.setPosition(o.boxID,o.position,o.referID,o.fixed)}),$(".ui_btn_close",Util.Dialog.box).on("click",function(){if(""==o.beforeClose||!$.isFunction(o.beforeClose)||o.beforeClose(this))return Util.Dialog.close(o.boxID,o.cfns,o),!1});var winarr=Util.Dialog.data.winarr;Util.Dialog.box.off().on("mousedown",function(){this.style.zIndex=Util.Dialog.data.zindex+=1;for(var i=0;i<winarr.length;i++)winarr[i][0]==o.boxID&&(winarr[i][1]=this.style.zIndex)}),document.onkeydown=function(e){if(e=e||window.event,27==e.keyCode){for(var zindex=[],i=0;i<winarr.length;i++)zindex.push(winarr[i][1]);for(var j=0;j<zindex.length;j++)winarr[j][1]==zindex.max()&&(Util.Dialog.close(winarr[j][0],o.cfns,o),zindex.remove(zindex.max()),o.hidden||winarr.remove(winarr[j]))}},$("#XYTipsWindowBg").bind("dblclick",function(e){e=e||window.event;var ele=e.srcElement?e.srcElement:e.target;Util.contains(Util.getID(o.boxID),ele)||Util.Dialog.close(o.boxID,o.cfns,o)})},create:function(o){var boxDom='<div class="ui_dialog_wrap"><div id="'+o.boxID+'" class="ui_dialog">';boxDom+='<table class="ui_table_wrap" cellspacing="0" cellpadding="0" border="0"><tbody>',boxDom+='<tr><td class="ui_border ui_td_00"></td><td class="ui_border ui_td_01"></td><td class="ui_border ui_td_02"></td></tr>',boxDom+='<tr><td class="ui_border ui_td_10"></td><td class="ui_td_11"><table class="ui_dialog_main" cellspacing="0" cellpadding="0" border="0"><tbody>',boxDom+='<tr><td><div class="ui_title_wrap"><div class="ui_title"><div class="ui_title_text"><span class="ui_title_icon"></span>'+o.title+'</div><div class="ui_btn_wrap"><span class="ui_btn_close">关闭</span><span class="ui_btn_restore">还原</span><span class="ui_btn_max">最大化</span><span class="ui_btn_min">最小化</span></div></div></div></td></tr>',boxDom+='<tr><td><div class="ui_content" id="'+o.boxID+'_content"></div></td></tr>',boxDom+='<tr><td><div class="ui_button_wrap"><div class="ui_resize"></div></div></td></tr></tbody></table>',boxDom+='</td><td class="ui_border ui_td_12"></td></tr>',boxDom+='<tr><td class="ui_border ui_td_20"></td><td class="ui_border ui_td_21"></td><td class="ui_border ui_td_22"></td></tr></tbody></table>',boxDom+='<iframe src="about:blank" class="ui_iframe" style="position:absolute;left:0;top:0; filter:alpha(opacity=0);opacity:0; scrolling=no;border:none;z-index:10714;"></iframe>',boxDom+='</div><div class="ui_move_temp" id="'+o.boxID+'_move_temp"></div><div class="ui_overlay" style=\'left:0px;width:100%;height:100%;min-height:'+$(document).height()+'px;\'><iframe src="about:blank" style="position:absolute;width:100%;height:'+$(document).height()+'px;filter:alpha(opacity=50);opacity:0.5;scrolling=no;border:none;z-index:870611;"></iframe></div></div>',$(boxDom).appendTo("body"),Util.Dialog.box=$("#"+o.boxID),Util.Dialog.box.css("zIndex",Util.Dialog.data.zindex+=1).addClass("ui_dialog_restore "+o.className).parent().addClass("ui_dialog_theme_"+o.theme),"tips"==o.type&&(o.showtitle=!1),1!=o.showtitle&&$(".ui_title_wrap",Util.Dialog.box).remove(),o.minBtn&&Util.Dialog.box.find(".ui_btn_min").css("visibility","visible"),o.maxBtn&&Util.Dialog.box.find(".ui_btn_max").css("visibility","visible"),o.showbg&&Util.Dialog.box.parent().find(".ui_overlay").css("visibility","visible"),o.showborder||(Util.Dialog.box.find(".ui_border").css({width:"0px",height:"0px",fontSize:"0",lineHeight:"0",visibility:"hidden",overflow:"hidden"}),Util.Dialog.box.find(".ui_resize").css({right:"5px",bottom:"5px"}),"dialog"==o.type&&Util.Dialog.box.find(".ui_dialog_main").addClass("ui_box_shadow")),Util.Dialog.setPosition(o)},loadContent:function(o){var $contentID=$(".ui_content",Util.Dialog.box),winarr=Util.Dialog.data.winarr,tipsDom='<em class="ui_arrow arrow-'+o.arrow+'" style="z-index:1;"></em><span class="ui_arrow arrow-'+o.arrow+'-in" style="z-index:2;"></span><i class="ui_tips_close">x</i>';Util.Dialog.data.contentType=$contentType=o.content.substring(0,o.content.indexOf(":")),$content="tips"==o.type?"<div class='ui_tips_content'><i class=\"ui_tips_content_ico\"></i>"+o.content.substring(o.content.indexOf(":")+1,o.content.length)+"</div>"+tipsDom:o.content.substring(o.content.indexOf(":")+1,o.content.length),Util.Dialog.data.contentTypeID=$content,$.ajaxSetup({global:!1});var _width=o.width,_height=o.height,_minHeight=o.minHeight;$contentID.css({width:_width,height:_height,"min-height":_minHeight});var dragBox;o.drag&&(dragBox=!0);var drag=function(){if(winarr.push([o.boxID,Util.getID(o.boxID).style.zIndex,$contentID.width(),$contentID.height()]),dragBox){var safe=Util.safeRange(o.boxID),tempBox=safe.width>400||safe.height>300?".ui_move_temp":"";Util.loadJS("XY_Drag.js",function(){Util.drag({obj:o.boxID,handle:".ui_title_text",lock:o.lock,fixed:o.fixed,temp:tempBox})})}};switch($contentType){case"text":$contentID.html($content),Util.Dialog.setPosition(o),drag(),""!=o.ofns&&$.isFunction(o.ofns)&&o.ofns(this);break;case"id":$("#"+$content).children().appendTo($contentID),Util.Dialog.setPosition(o),drag(),""!=o.ofns&&$.isFunction(o.ofns)&&o.ofns(this);break;case"img":$.ajax({beforeSend:function(){$contentID.addClass("ui_loading").html("<img src='"+Util.config.JSfile+"loading.gif' class='ui_box_loading' alt='加载中...' />"),Util.Dialog.setPosition(o)},error:function(){$contentID.removeClass("ui_loading").html("<p class='ui_box_error'><span class='ui_box_callback_error'></span>加载数据出错！</p>"),Util.Dialog.setPosition(o)},success:function(html){Util.loadJS("XY_Img.js",function(){Util.Img.ready($content,function(){$contentID.addClass("ui_hark_imgBug").removeClass("ui_loading").html("<img src="+$content+" alt='' />"),Util.Dialog.setPosition(o),drag()})}),""!=o.ofns&&$.isFunction(o.ofns)&&o.ofns(this)}});break;case"swf":$.ajax({beforeSend:function(){$contentID.addClass("ui_loading").html("<img src='"+Util.config.JSfile+"loading.gif' class='ui_box_loading' alt='加载中...' />"),Util.Dialog.setPosition(o)},error:function(){$contentID.removeClass("ui_loading").html("<p class='ui_box_error'><span class='ui_box_callback_error'></span>加载数据出错！</p>"),Util.Dialog.setPosition(o)},success:function(html){Util.loadJS("XY_Swf.js",function(){$contentID.removeClass("ui_loading").html("<div id='"+o.boxID+'swf\'><h1>Alternative content</h1><p><a href="http://www.adobe.com/go/getflashplayer"><img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" /></a></p></div><script type="text/javascript">swfobject.embedSWF(\''+$content+"', '"+o.boxID+"swf', '"+o.width+"', '"+o.height+"', '9.0.0', 'expressInstall.swf');</script>"),$("#"+o.boxID+"swf").css({position:"absolute",left:"0",top:"0",textAlign:"center"}),Util.Dialog.setPosition(o),drag()}),""!=o.ofns&&$.isFunction(o.ofns)&&o.ofns(this)}});break;case"url":var contentDate=$content.split("?");$.ajax({beforeSend:function(){$contentID.addClass("ui_loading").html("<img src='"+Util.config.JSfile+"loading.gif' class='ui_box_loading' alt='加载中...' />"),Util.Dialog.setPosition(o)},type:contentDate[0],url:contentDate[1],data:contentDate[2],error:function(){$contentID.removeClass("ui_loading").html("<p class='ui_box_error'><span class='ui_box_callback_error'></span>加载数据出错！</p>"),Util.Dialog.setPosition(o)},success:function(html){$contentID.removeClass("ui_loading").html(html),Util.Dialog.setPosition(o),drag(),""!=o.ofns&&$.isFunction(o.ofns)&&o.ofns(this)}});break;case"iframe":$contentID.css({overflowY:"hidden"}),$.ajax({beforeSend:function(){$contentID.addClass("ui_loading").html("<img src='"+Util.config.JSfile+"loading.gif' class='ui_box_loading' alt='加载中...' />"),Util.Dialog.setPosition(o)},error:function(){$contentID.removeClass("ui_loading").html("<p class='ui_box_error'><span class='ui_box_callback_error'></span>加载数据出错！</p>"),Util.Dialog.setPosition(o)},success:function(html){$contentID.removeClass("ui_loading").html('<iframe src="'+$content+'" style="width:100%;height:100%;" id="'+o.boxID+'frame" scrolling="auto" frameborder="0"></iframe>'),$("#"+o.boxID+"frame").bind("load",function(){var frame=document.getElementById(o.boxID+"frame");if(""==o.width||""==o.height)try{frame=frame.contentWindow.document,width=Math.max(frame.body.scrollWidth,frame.documentElement.scrollWidth),height=Math.max(frame.body.scrollHeight,frame.documentElement.scrollHeight),Util.Dialog.box.find(".ui_content").css({width:width+"px",height:height+"px"})}catch(_){}else Util.Dialog.box.find(".ui_content").css({width:_width+"px",height:_height+"px"});Util.Dialog.setPosition(o),drag(),""!=o.ofns&&$.isFunction(o.ofns)&&o.ofns(this)})}})}},setPosition:function(o){Util.setPosition(o.boxID,{follow:o.referID,position:o.position,fixed:o.fixed});var safe=Util.safeRange(o.boxID);if($(".ui_iframe",Util.Dialog.box).css({width:safe.width+"px",height:safe.height+"px"}),"tips"==o.type){var t=o.tips,mode="left"==o.arrow||"right"==o.arrow?"top":"left",val=t.val||"10",style=t.style||"default",radius=t.radius||"0",auto=t.auto||!0;Util.Dialog.box.find(".ui_button_wrap").hide().end().find(".ui_dialog_main").css({border:"none",background:"none"}).find(".ui_content").addClass("ui_tips_style_"+style).css({borderRadius:radius+"px",textAlign:"left"}).find(".ui_arrow").css(mode,val+"px").end().find(".ui_tips_close").click(function(){Util.Dialog.close(o.boxID,o.cfns,o)});var ob=Util.getPosition(o.boxID),s=Util.safeRange(o.referID),st=document.body.scrollTop||document.documentElement.scrollTop;switch(o.arrow){case"left":Util.Dialog.box.css({left:ob.x+8+"px",top:ob.y+"px"}),(auto=p.clientWidth-ob.x<Util.Dialog.box.outerWidth())&&(Util.Dialog.box.css({left:rp.x-Util.Dialog.box.outerWidth()-8}).find("em.ui_arrow").removeClass("arrow-left").addClass("arrow-right").end(),find("span.ui_arrow").removeClass("arrow-left-in").addClass("arrow-right-in"));break;case"right":Util.Dialog.box.css({left:ob.x-10+"px",top:ob.y+"px"}),(auto=ob.x<0)&&(Util.Dialog.box.css({left:rp.x+s.width+8}).find("em.ui_arrow").removeClass("arrow-right").addClass("arrow-left").end(),find("span.ui_arrow").removeClass("arrow-right-in").addClass("arrow-left-in"));break;case"bottom":Util.Dialog.box.css({left:ob.x+"px",top:ob.y-8+"px"}),(auto=ob.y<0)&&Util.Dialog.box.css({top:rp.y+s.height+8}).find("em.ui_arrow").removeClass("arrow-bottom").addClass("arrow-top").end().find("span.ui_arrow").removeClass("arrow-bottom-in").addClass("arrow-top-in");break;case"top":Util.Dialog.box.css({left:ob.x+"px",top:ob.y+8+"px"}),(auto=p.clientHeight-ob.y+st<Util.Dialog.box.outerHeight())&&Util.Dialog.box.css({top:rp.y-Util.Dialog.box.outerHeight()-8}).find("em.ui_arrow").removeClass("arrow-top").addClass("arrow-bottom").end().find("span.ui_arrow").removeClass("arrow-top-in").addClass("arrow-bottom-in")}}},yesBtn:function(o){var fn=o.yesBtn[1]||function(){},text=o.yesBtn[0]||"确定",yesBtnDom='<button class="ui_box_btn ui_box_btn_yes">'+text+"</button>";Util.Dialog.box.find(".ui_button_wrap").append(yesBtnDom),""!=fn&&$.isFunction(fn)&&Util.Dialog.box.find(".ui_box_btn_yes").click(function(){var f=fn();0!=f&&Util.Dialog.close(o.boxID,o.cfns,o)})},noBtn:function(o){var fn=o.noBtn[1]||function(){},text=o.noBtn[0]||"取消",noBtnDom='<button class="ui_box_btn ui_box_btn_no">'+text+"</button>";Util.Dialog.box.find(".ui_button_wrap").append(noBtnDom),""!=fn&&$.isFunction(fn)&&Util.Dialog.box.find(".ui_box_btn_no").click(function(){var f=fn();0!=f&&Util.Dialog.close(o.boxID,o.cfns,o)})},customBtn:function(o){var fn=o.customBtn[1]||function(){},text=o.customBtn[0]||"",className="";"[object Object]"===Object.prototype.toString.call(text)&&(className=text.className||"",text=text.text);var customBtnDom='<button class="ui_box_btn ui_box_btn_custom '+className+'">'+text+"</button>";Util.Dialog.box.find(".ui_button_wrap").append(customBtnDom),""!=fn&&$.isFunction(fn)&&Util.Dialog.box.find(".ui_box_btn_custom").click(function(){var f=fn();0!=f&&Util.Dialog.close(o.boxID,o.cfns,o)})},hide:function(o){var _this=$("#"+o.boxID);return _this.parent(".ui_dialog_wrap").hide(),!1},show:function(o){var _this=$("#"+o.boxID);return _this.parent(".ui_dialog_wrap").show(),!1},min:function(o){var _this=$("#"+o.boxID);$(".ui_btn_min",_this).on("click",function(){_this.find(".ui_content").css({width:"0",height:"0",display:"none",visibility:"hidden"}).end().find(".ui_button_wrap").hide();var safe=Util.safeRange(o.boxID);return $(".ui_iframe",_this).css({width:safe.width+"px",height:safe.height+"px"}),_this.addClass("ui_dialog_min").removeClass("ui_dialog_restore ui_dialog_max"),o.drag&&(Util.config.drag=!0),!1})},max:function(o){var _this=$("#"+o.boxID);$(".ui_btn_max",_this).on("click",function(){var p=Util.pageSize();return w=p.clientWidth-(o.showborder?10:2),h=p.clientHeight-(o.showtitle?34:2)-(o.button?36:0),_this.find(".ui_content").css({width:w+"px",height:h+"px"}),Util.Dialog.setPosition(o),_this.addClass("ui_dialog_max").removeClass("ui_dialog_restore ui_dialog_min"),o.drag&&(Util.config.drag=!1,_this.find(".ui_title_text").css("cursor","default")),!1})},restore:function(o){var _this=$("#"+o.boxID),winarr=Util.Dialog.data.winarr;$(".ui_btn_restore",_this).on("click",function(){for(var i=0;i<winarr.length;i++)o.boxID==winarr[i][0]&&(_this.find(".ui_content").css({width:winarr[i][2]+"px",height:winarr[i][3]+"px",display:"block",visibility:"visible"}).end().find(".ui_button_wrap").show(),Util.Dialog.setPosition(o),_this.addClass("ui_dialog_restore").removeClass("ui_dialog_min ui_dialog_max"));return o.drag&&(Util.config.drag=!0,_this.find(".ui_title_text").css("cursor","move")),!1})},close:function(obj,cfns,o){if("string"!=typeof obj)return void alert("请指定弹出窗口的ID！");if(box=$("#"+obj),0!=box.length){if("id"==Util.Dialog.data.contentType&&box.find(".ui_content").children().appendTo($("#"+Util.Dialog.data.contentTypeID)),"undefined"!=typeof data_pick_id&&obj==data_pick_id?box.parent().hide():"popup_yaxis_set_id"==obj?box.parent().hide():o&&o.hidden?box.parent().hide():(box.parent().find("iframe").remove(),Util.clearIframe(),box.parent().remove()),!o||!o.hidden){$("#XYTipsWindowBg").animate({opacity:"0"},100,function(){$(this).remove()});for(var i=0;i<Util.Dialog.data.winarr.length;i++)obj==Util.Dialog.data.winarr[i][0]&&Util.Dialog.data.winarr.remove(Util.Dialog.data.winarr[i])}""!=cfns&&$.isFunction(cfns)&&cfns(this)}}})}(jQuery);
//# sourceMappingURL=../../../../maps/common/frame/env_dialog/xydialog/XY_Dialog.js.map
